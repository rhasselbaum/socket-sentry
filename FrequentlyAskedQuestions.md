If you're looking for tips, tricks, and troubleshooting advice to get the most out of Socket Sentry, you've come to the right place. Here are some common questions and answers to get you going. Got a question that isn't answered here? Post it in our [discussion group](http://groups.google.com/group/socket-sentry).



# General #

## How does Socket Sentry get its data? ##

First, a little background. the tool consists of three main parts:
  * A [D-Bus](http://www.freedesktop.org/wiki/Software/dbus) service that runs as root to collect network and process data.
  * A Plasma [data engine](http://techbase.kde.org/Development/Tutorials/Plasma/DataEngines) that is really just a thin wrapper around the service.
  * A Plasma applet that visualizes the data provided by the service through the engine.

Most of the interesting work happens inside the service. This component captures packet headers as they pass through each monitored network interface. Using this data, it builds a rolling history of network activity and calculates statistics like throughput, peak rate, current device state (sending or receiving), and so forth. The connections observed through packet capture are then matched against the kernel's network connection tables exposed in the `/proc/net` file system directory. This is the same data source that is used by well-known tools like [netstat](http://www.faqs.org/docs/linux_network/x-087-2-iface.netstat.html) and enables Socket Sentry to match packet traffic to OS processes--a feature that is unique to Socket Sentry among Linux tools as far as we know. The service aggregates this data on a periodic basis and sends it to authorized listeners over its D-Bus interface.

## Can I run it on GNOME, Xfce, or `<`insert favorite desktop here`>`? ##

No, not yet. However, the code has been structured in such a way as to minimize coupling between the back-end data collection service and the UI, so if you are a developer interested in creating an alternative UI, it should not be terribly hard. The service component has no dependency on KDE and communicates with other processes over a standard D-Bus interface.

## Does it support other operating systems besides Linux? ##

We have not tested Socket Sentry on any other operating systems. If you are a developer interested in porting it to another OS, we welcome your help! Most of the code should be portable with the possible exception of the `/proc` file system details, which are probably specific to Linux.

## Can I run it on my production server? ##

The tool is designed for real-time connection monitoring on a personal computer, but we think it's pretty useful for home or small workgroup servers, too. If you're running a bigger box than that, a project like [ntop](http://www.ntop.org) will probably work better for you, since it provides historical analysis and is more suited to unattended operation. Plus, although Socket Sentry is designed to go easy on system resources, correlating network traffic to OS processes is not a cost-free operation and probably of little value to server administrators. After all, if you're running, say, a web server, the fact that most of your connections are going to Apache is probably not surprising or useful information.

## How can I reduce CPU overhead? ##

Socket Sentry is designed to minimize its impact on system resources, particularly CPU usage. Here are some additional tips to reduce overhead.
  1. Place the widget on a panel so it will only appear when you click its icon. Socket Sentry uses very few resources when it's "iconified" like this.
  1. Turn off host name lookups in _global settings_.
  1. In _local settings_, set the row aggregation mode to "host pair and program". This reduces the amount of work required to redraw the table.

## Can I use the data generated by Socket Sentry in a different tool? ##

Yes! The service exposes a simple D-Bus interface to which any [authorized](#Security.md) user process can connect. Traffic updates are pushed out asynchronously via signals. If you're creating another Plasma widget, integration is even easier. You can just connect to the [data engine](http://techbase.kde.org/Development/Tutorials/Plasma/DataEngines) and receive push updates that way instead. If you produce a tool based on the Socket Sentry service or engine, please [let us know](http://groups.google.com/group/socket-sentry) and we'd be happy to link to it.

Socket Sentry also ships with a command line executable called `socksent-client`. However, this is intended as a testing tool for the service itself and we do not recommend that you use it in your applications, as the output format is subject to change without notice. (Really!) We may provide a stable command line interface into the service at some point, but in the meantime, we recommend you develop your own to expose the data you need in the format you need it. Take a look at `SsReceiver.cpp` for an example.

## What can I do with the custom packet filter expression setting? ##

Lots! We think this is one of the coolest features of Socket Sentry, which the authors can take absolutely no credit for because it's all handled through the magic of the [pcap](http://www.tcpdump.org) library. With filter expressions, you can limit the kinds of traffic that will appear in widgets by many different criteria. For example, you could specify `port 80 or port 443` to see only traffic going to and from the default ports used by web servers. You could specify `not host ::1 and not net 127` to eliminate traffic flowing between processes on the local PC. (Although selecting physical network devices for monitoring will accomplish this, too.) There are many possibilities. Unfortunately, we have not found an official up-to-date online reference for the expression language used by pcap, but you may be able to find one installed on your machine by typing `man pcap-filter` at a terminal.

Please note that the custom filter expression setting in Socket Sentry gets applied globally to all monitored devices and widgets running on the machine.

## Can I place it in the system tray? ##

Yes, this is supported in release 0.9.3 or later. To add it, go to the system tray settings dialog and you should see Socket Sentry listed in the Plasma Widgets section.

# It's a feature, not a bug! #

## Why does Socket Sentry report a different data transfer rate than my application? ##

Socket Sentry sees the raw packets that pass through the kernel, which means that its data transfer rate calculations include things like packet headers and retransmissions that are normally invisible to an application. In this way, Socket Sentry's rate is "closer to the metal" than the rate reported by many applications. Additionally, some download managers report the download (incoming) data rate only. Socket Sentry can show that rate ("In rate"), but it can also show the upload rate ("Out rate") or the sum of the two ("Rate").

Also, some applications equate 1 KB with 1000 bytes instead of 1024 bytes when calculating transfer rates. Socket Sentry uses multiples of 1024 when converting units of rate.

Finally, Socket Sentry may be set to aggregate more than one connection into a single table row, which will also combine their rates. To see rates for individual connections, select "Show one row per connection" in the _local settings_ dialog.

## Why does '?' sometimes appear as the process or program name? ##

As connections are created and destroyed, there is some period of time in which the connection appears in the kernel's connection table but is gone before Socket Sentry is able to correlate it to a process. Instead of hiding those connections, the developers have chosen to show them with no associated process.

## I want to use regular expressions in the search box. Can I? ##

Although it would have been technically easy to support this, the search box does not currently interpret regular expressions because it would be confusing to users who don't understand how they work. We opted for simplicity here. You can, however, use wildcards. For example, typing "f`*`fox" will match `firefox`.

## What does an asterisk mean when it appears next to a process or program? ##

See: [Why do some connections show up with the wrong process or program?](#Why_do_some_connections_show_up_with_the_wrong_process_or_progra.md).

## Why don't I see broadcast or multicast traffic? ##

Socket Sentry filters captured packets by entries that appear in the operating system's connection tables. That means only unicast and perhaps some multicast traffic will appear. In general, if a connection doesn't show up using the [netstat](http://www.faqs.org/docs/linux_network/x-087-2-iface.netstat.html) command line tool, it won't show up in Socket Sentry either.

## Why don't I see some connections? ##

If you see an established TCP or UDP connection in [netstat](http://www.faqs.org/docs/linux_network/x-087-2-iface.netstat.html) but there is no corresponding connection in Socket Sentry, the most likely explanation is that there has not been any traffic flowing over that connection in a while. Socket Sentry shows only utilized connections, so connections that have been idle for about 30 seconds will disappear. Additionally, some very short-lived connections may never appear if they come and go within the connection table polling interval. Yet another possibility is that you've applied a custom filter that is excluding the traffic in question.

## When I type text into the search box, I get back some rows that don't match. Why? ##

The search box searches all the columns for the text you typed including hidden ones. You can click and hover over one of these rows and see the values of hidden columns in the tooltip text.

# It's a bug, not a feature! #

## I am getting a cryptic error: "Launch helper exited with unknown return code 254". Help? ##

This error comes from D-Bus. If you have just installed or upgraded Socket Sentry, first try restarting Plasma. You can do that by logging out and logging back in, or by executing the following commands in a terminal:

```
kquitapp plasma-desktop
plasma-desktop
```

If restarting Plasma doesn't help, the next most likely cause is that your user account doesn't have permission to activate the Socket Sentry D-Bus service on demand. If you're logged in at the local console, this shouldn't be a problem. But if you're not or your Linux distribution doesn't support the `at_console='true'` attribute in D-Bus configuration files, then you might run into this. To work around it, create a new user group on your machine called `socketsentry` and add your user account(s) to it. That should enable you to activate and access the service over D-Bus.

## Why do some connections show up with the wrong process or program? ##

In Linux and other UNIX-like operating systems, sockets (connections) can be shared among processes. This is typical among server daemons like `sshd`, but can also arise in desktop scenarios. For example, it can happen when Firefox launches a helper application like Amarok to open a music stream. In situations like this, Socket Sentry cannot tell with certainty which process out of those sharing the socket is responsible for the traffic. By default, it chooses the oldest process. This is appropriate for the Firefox helper scenario, but may not be appropriate for daemons. You can tell Socket Sentry to assign traffic to the newest process instead via the _global settings_ configuration dialog. Processes that are sharing a socket with others are displayed with an asterisk ('`*`') after the process ID or program name. By clicking and hovering over the row, you can see all the processes/programs sharing the socket in the tooltip.

## I get an "unsupported data link layer type" or a "filtering not implemented" error. What can I do? ##

The packet capture library we use (called [pcap](http://www.tcpdump.org)) exposes only raw packet data, which means the routines to decode the data link headers have to be implemented inside Socket Sentry. We support the most common link layer types like Ethernet, but others need to be written. If you're interested in getting support for your data link layer, create an [issue](http://code.google.com/p/socket-sentry/issues/list) in our tracker system. Include the exact error message and a description of your equipment and network. If possible, please include a sample of captured traffic using [Wireshark](http://www.wireshark.org) or [tcpdump](http://www.tcpdump.org).

## Why don't I see any tooltips when I click and hover over a row? ##

This is caused by a regression bug in early releases of Qt 4.6, which affects Kubuntu 10.04 and possibly other distributions shipping early versions of KDE 4.4. The fix is to upgrade to Qt 4.6.3 or later. For Kubuntu, it's available in the [Kubuntu Updates PPA](https://launchpad.net/~kubuntu-ppa/+archive/ppa).

# Security #

## Why does the service need to run as root? ##

This is required on Linux machines in order to capture the packet headers using the [pcap](http://www.tcpdump.org) library and to read the process file descriptors from the `/proc` file system. Note that since this data is accumulated for the system as a whole, any user process that is allowed to receive updates from the Socket Sentry service over D-Bus will see traffic statistics of all the users on the box. However, by default, only users logged in at the local console or members of the `socketsentry` group are allowed this access, and this can be further tightened as explained below.

## How can I restrict access to Socket Sentry data? ##

Out of the box, only users who are logged in at the local console or members of the `socketsentry` group are allowed to receive updates from the Socket Sentry service. We use [D-Bus access policies](http://www.redhat.com/magazine/003jan05/features/dbus/#security) to enforce this restriction. The security policy is defined in `/etc/dbus-1/system.d/org.socketsentry.Watcher.conf`, which can be edited to your liking. For example, by removing the `policy at_console="true"` section, you can restrict access to only users in the `socketsentry` group. (You must create this group yourself.)

Note that under no circumstances does Socket Sentry provide access to payload data of any network communications. It only reads data link layer and TCP/IP header data.